<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Chapter 04 - Simulationstechniken</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Chapter 04 | Simulationstechniken</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Chapter 04" /> <meta name="author" content="Lars Pastewka" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Simulationstechniken" /> <meta property="og:description" content="Simulationstechniken" /> <link rel="canonical" href="http://localhost:4000/_lecture/chapter04.html" /> <meta property="og:url" content="http://localhost:4000/_lecture/chapter04.html" /> <meta property="og:site_name" content="Simulationstechniken" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2021-08-18T00:00:00-05:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Chapter 04" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Lars Pastewka"},"@type":"BlogPosting","description":"Simulationstechniken","url":"http://localhost:4000/_lecture/chapter04.html","headline":"Chapter 04","dateModified":"2021-08-18T00:00:00-05:00","datePublished":"2021-08-18T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/_lecture/chapter04.html"},"@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> Simulationstechniken </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/_lecture/" class="nav-list-link">Vorlesung</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/_homework/" class="nav-list-link">Übungsaufgaben</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/_notes/" class="nav-list-link">Notizen</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="http://localhost:4000/impressum.html" class="nav-list-link">Impressum</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Simulationstechniken" aria-label="Search Simulationstechniken" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <!-- Add a favicon --> <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"> <link rel="stylesheet" href="/_includes/md.css"> <!-- Enable Katex for math rendering https://stackoverflow.com/a/57370526 --> <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous"> <link rel="stylesheet" href="/_includes/md.css"> <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js" integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script> --> <script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script> <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> <script> MathJax = { tex: { tags: 'ams' } }; $(document).ready(function(){ key = 'href'; $('[href^="https://uni-freiburg.cloud.panopto.eu"]').replaceWith(function() { return '<div class="video-container43"><iframe src='+$(this).attr(key)+' frameborder="0" allowfullscreen></iframe></div>'; }); $('[href^="https://www.youtube.com"]').replaceWith(function() { return '<div class="video-container169"><iframe src='+$(this).attr(key)+' frameborder="0" allowfullscreen></iframe></div>'; }); }); </script> <style type="text/css"> .video-container169 { position: relative; padding-bottom: 56.25%; /* 16:9 */ height: 0; } .video-container169 iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; } .video-container43 { position: relative; padding-bottom: 75%; /* 4:3; */ height: 0; } .video-container43 iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; } </style> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="">Lecture</a></li> <li class="breadcrumb-nav-list-item"><span>Chapter 04</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <hr /> <h2 class="chapterHead"> <a href="#x1-10004" class="anchor-heading" aria-labelledby="x1-10004"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span class="titlemark">Chapter 4</span><br /> <a id="x1-10004"></a>Temperature control </h2> <div id="shaded*-1" class="framedenv"><!-- l. 3 --> <p class="noindent"><span class="underline"><span class="cmbx-12">Context:</span></span> Most molecular dynamics calculations are carried out in <span class="cmti-12">thermal</span> <span class="cmti-12">equilibrium</span>. Equilibrium is typically maintained by coupling the molecular calculation to a virtual <span class="cmti-12">heat bath</span>, with which it exchanges energy but no particles. This chapter discusses properties of thermal equilibrium and introduces simple algorithms for heat-bath coupling.</p> </div> <!-- l. 7 --> <p class="noindent"><a href="https://uni-freiburg.cloud.panopto.eu/Panopto/Pages/Embed.aspx?id=2adb1988-1575-473f-8b8b-ad230158c41c" class="url"><span class="cmtt-12">https://uni-freiburg.cloud.panopto.eu/Panopto/Pages/Embed.aspx?id=2adb1988-1575-473f-8b8b-ad230158c41c</span></a></p> <h3 class="sectionHead"> <a href="#x1-20004.1" class="anchor-heading" aria-labelledby="x1-20004.1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span class="titlemark">4.1</span> <a id="x1-20004.1"></a>Introduction </h3> <!-- l. 11 --> <p class="noindent">In order to talk about temperature control, we need to discuss the properties of thermal equilibrium. This is the realm of <span class="cmti-12">statistical mechanics</span> or <span class="cmti-12">statistical</span> <span class="cmti-12">thermodynamics</span> that is discussed in more detail in Chapter <span class="cmbx-12">??</span> and Appendix <span class="cmbx-12">??</span>. A key outcome is that the velocity components are distributed according to a Boltzmann distribution. The velocity magnitude is then distributed according to a Maxwell-Boltzmann distribution.</p> <!-- l. 13 --> <p class="indent">A thermostat implicitly models the coupling to a heat bath much larger than the atomistic system under investigation. Because it is much larger, its temperature will not change when energy flows from and to the heat bath. The atomistic system becomes canonical and its statistics follows the <span class="cmti-12">canonical</span> <span class="cmti-12">ensemble</span>. An ensemble here describes which parameters are constrained, and the canonical ensemble is often also called the <span class="cmti-12">NVT-ensemble</span>, because particle number \(N\), volume \(V\) and temperature \(T\) are constrained (fixed). An ideal thermostat guarantees relaxation of the distribution of atomic degrees of freedom to the <span class="cmti-12">canonical distribution function</span> (see Chapter <span class="cmbx-12">??</span>).</p> <!-- l. 15 --> <p class="indent">We will here start with a mechanistic treatment of thermostats and underpin it with more rigorous theory in Chapter <span class="cmbx-12">??</span>. The present chapter teaches the basic concepts required for an implementation of simple thermostatting schemes. Thermostats can be roughly categorized into constraint methods (velocity rescaling and Berendsen), stochastic methods (Andersen, Langevin and dissipative particle dynamics) and extended system methods (Nosé-Hoover). Constraint and extended system methods are deterministic, i.e. they follow the same path when starting from the same initial state. In this chapter we will only discuss the simple constraint methods. We will come back to more advanced methods for temperature control later in these notes.</p> <!-- l. 18 --> <p class="noindent"></p> <h3 class="sectionHead"> <a href="#x1-30004.2" class="anchor-heading" aria-labelledby="x1-30004.2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span class="titlemark">4.2</span> <a id="x1-30004.2"></a>Simple themostatting schemes </h3> <!-- l. 20 --> <p class="noindent"></p> <h4 class="subsectionHead"> <a href="#x1-40004.2.1" class="anchor-heading" aria-labelledby="x1-40004.2.1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span class="titlemark">4.2.1</span> <a id="x1-40004.2.1"></a>Velocity rescaling </h4> <!-- l. 22 --> <p class="noindent">The crudest (and simplest) form of fixing the temperature in a molecular dynamics simulation to a value of \(T_0\) is by velocity rescaling. Since the instantaneous temperature is \begin{equation} \frac{3}{2} k_BT = \sum _i \frac{1}{2} mv_i^2, \end{equation} we obtain a temperature of \(T_0\) if we rescale all velocities by \begin{equation} \label{eq:velocity-rescaling} \vec{v}_i \to \lambda \vec{v}_i\ \text{ with } \ \lambda =\sqrt{\frac{T_0}{T}} \end{equation} after every time step. This is a very intrusive way of setting the temperature and should not be used in any practical situations, but it is a good illustration of how a simple constraint method works.</p> <!-- l. 33 --> <p class="noindent"></p> <h4 class="subsectionHead"> <a href="#x1-50004.2.2" class="anchor-heading" aria-labelledby="x1-50004.2.2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span class="titlemark">4.2.2</span> <a id="x1-50004.2.2"></a>Berendsen thermostat </h4> <!-- l. 35 --> <p class="noindent">The <a href="#Xberendsen_molecular_1984">Berendsen et al.</a> (<a href="#Xberendsen_molecular_1984">1984</a>) thermostat uses a damping or acceleration term to control the temperature. The governing equations of motion of the Berendsen thermostat are \begin{equation} m \dot{\vec{v}}_i = \vec{f}_i + \frac{m}{2\tau } \left ( \frac{T_0}{T} -1 \right ) \vec{v}_i \label{eq:berendsen} \end{equation} where \(\tau \) is a relaxation time constant. The factor in front of the velocity is a damping coefficient. The coefficient vanishes for \(T = T_0\), Eq. \eqref{eq:berendsen} then reduces to Newton’s equation of motion. However, it has a positive sign (=speeds up particles) for \(T &lt; T_0\) and has negative sign (=slows down particles) for \(T &gt; T_0\). From Eq. \eqref{eq:berendsen} we can easily derive a differential equation for the evolution of the temperature: \begin{align} 3k_B \frac{dT}{dt} &amp;= \sum _i m \vec{v}_i \cdot \dot{\vec{v}}_i \\ &amp;= \sum _i \left [ \vec{v}_i \cdot \vec{f}_i + \frac{1}{2\tau } \left ( \frac{T_0}{T} - 1 \right ) m v_i^2 \right ] \\ &amp;= - \frac{dE_\text{pot}}{dt} + \frac{3k_B(T_0 - T)}{\tau } \end{align}</p> <!-- l. 52 --> <p class="indent">This can be written as \begin{equation} \label{eq:berendsen-temperature-evolution} \frac{dT}{dt} = -\frac{T-T_0}{\tau } + S \end{equation} where \(S=-\frac{1}{3k_B} \frac{dE_\text{pot}}{dt}\) is the change of <span class="cmti-12">potential</span> energy and constitutes an additional temperature (energy) source.</p> <!-- l. 59 --> <p class="indent">For \(S = 0\), this equation is solved by \begin{equation} \label{eq:berendsen-explicit-temperature-evolution} T(t) = T_0 + (T_1-T_0) e^{-t/\tau } \end{equation} The temperature relaxes exponentially from the intial value \(T_1\) towards \(T_0\). We directly see that \(\tau \) in Eq. \eqref{eq:berendsen} is indeed the relaxation time constant.</p> <!-- l. 66 --> <p class="indent">Note that Eq. \eqref{eq:berendsen-explicit-temperature-evolution} suggests an implementation of the Berendsen thermostat in terms of velocity rescaling. During at single time step \(\Delta t \ll \tau \), the temperature changes from \(T\) to \(T_0 + (T-T_0)e^{-\Delta t / \tau }\). We can implement this as velocity rescaling, Eq. \eqref{eq:velocity-rescaling}, with \begin{equation} \lambda = \sqrt{\frac{T_0}{T} + \left ( 1- \frac{T_0}{T} \right ) e^{-\frac{\Delta t}{\tau }}} \approx \sqrt{1+ \left ( \frac{T_0}{T} - 1 \right ) \frac{\Delta t}{\tau }} \end{equation} where \(T\) is the current (measure) temperature and \(T_0\) is the target temperature.</p> <!-- l. 73 --> <p class="indent">A Berendsen thermostat therefore constitutes a gentle way of rescaling velocities. The relaxation time \(\tau \) determines the strength of the coupling between thermal bath and atomistic system. The velocity rescaling limit \(\lambda \to \sqrt{T_0/T}\) is obtained as \(\tau \to 0\). Thermostats should be tuned as weak as possible and as strong as necessary to disturb the system the least while still allowing it to reach the target temperature within the simulation time. There is the additional requirement \(\tau \gg \Delta t\) (where \(\Delta t\) is the time step), otherwise equation Eq. \eqref{eq:berendsen-temperature-evolution} will not be sampled properly numerically. The velocity rescaling thermostat discussed above is bad because it is very strong, but also because it violates \(\tau \gg \Delta t\).</p> <!-- l. 75 --> <p class="noindent"></p> <h3 class="sectionHead"> <a href="#x1-60004.3" class="anchor-heading" aria-labelledby="x1-60004.3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span class="titlemark">4.3</span> <a id="x1-60004.3"></a>Equilibrating a molecular simulation </h3> <!-- l. 77 --> <p class="noindent">A “happy” molecular dynamics simulation will nicely run at constant temperature. Simulations are only this happy once they are <span class="cmti-12">equilibrated</span> and this equilibration implies that the positions \(\{\vec{r}_i\}\) are such that the system resides somewhere near a (potentially local) minimum in the potential energy landscape. When we set up a new simulation, we have to guess a set of \(\{\vec{r}_i\}\) that are often far away from this minimum. (For crystalline solids this guess is simple, since we typically know the crystal structure that we are interested in. For liquids, the guess is more difficult since the overall structure is disordered.) Since the forces \(\{\vec{f}_i\}\) point towards the minimum, the system will evolve in this direction and the potential energy \(E_\text{pot}\) will decrease over time, \(d E_\text{pot}/dt &lt; 0\). Equation \eqref{eq:berendsen-temperature-evolution} tells us, that this leads to an increase in temperature since \(S&gt;0\).</p> <!-- l. 79 --> <p class="indent">A common problem is that this temperature can be large enough to vaporize the system, i.e. the temperature increases above the vaporization point. The first step in any molecular dynamics simulation is hence to <span class="cmti-12">equilibrate</span> the system while avoiding a temperature rise above the point of vaporization (or melting if you are setting up a solid). This can be achieved by running a calculation with a Berendsen thermostat and a strong coupling (i.e. a small \(\tau \)). Once the system has equilibrated, the value of \(\tau \) can be adjusted to a more reasonable relaxation time that does not disturb the calculation too much. Good values for \(\tau \) are between \(1\) ps and \(10\) ps.</p> <!-- l. 81 --> <p class="indent">Note that if we <span class="cmti-12">continuously</span> pump energy into our system, for example because we deform it externally, then Eq. \eqref{eq:berendsen-temperature-evolution} acquires a non-zero source term, \(S &gt; 0\). Assuming \(S\) is constant over time, the final temperature is shifted to \(T_0\,' = T_0 + S\tau \). This temperature offset gets smaller with increasing coupling strength \(1/\tau \).</p> <h2 class="likechapterHead"> <a href="#x1-70004.3" class="anchor-heading" aria-labelledby="x1-70004.3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a id="x1-70004.3"></a>Bibliography </h2> <div class="thebibliography"> <p class="bibitem"><span class="biblabel"><a id="Xberendsen_molecular_1984"></a><span class="bibsp">   </span></span>H. J. C. Berendsen, J. P. M. Postma, W. F. van Gunsteren, A. DiNola, and J. R. Haak. Molecular dynamics with coupling to an external bath. <span class="cmti-12">J. Chem. Phys.</span>, 81(8):3684–3690, 1984. URL <a href="https://doi.org/10.1063/1.448118" class="url"><span class="cmtt-12">https://doi.org/10.1063/1.448118</span></a>.</p> </div> <hr> <footer> <p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2017-2020 Andreas Greiner, 2020-2021 Lars Pastewka.</a></p> <div class="d-flex mt-2"> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
