<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Chapter 02 - Simulationstechniken</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Chapter 02 | Simulationstechniken</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Chapter 02" /> <meta name="author" content="Lars Pastewka" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Simulationstechniken" /> <meta property="og:description" content="Simulationstechniken" /> <link rel="canonical" href="http://localhost:4000/_lecture/chapter02.html" /> <meta property="og:url" content="http://localhost:4000/_lecture/chapter02.html" /> <meta property="og:site_name" content="Simulationstechniken" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2021-08-18T00:00:00-05:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Chapter 02" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Lars Pastewka"},"@type":"BlogPosting","description":"Simulationstechniken","url":"http://localhost:4000/_lecture/chapter02.html","headline":"Chapter 02","dateModified":"2021-08-18T00:00:00-05:00","datePublished":"2021-08-18T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/_lecture/chapter02.html"},"@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> Simulationstechniken </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/_lecture/" class="nav-list-link">Vorlesung</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/_homework/" class="nav-list-link">Übungsaufgaben</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/_notes/" class="nav-list-link">Notizen</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="http://localhost:4000/impressum.html" class="nav-list-link">Impressum</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Simulationstechniken" aria-label="Search Simulationstechniken" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <!-- Add a favicon --> <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"> <link rel="stylesheet" href="/_includes/md.css"> <!-- Enable Katex for math rendering https://stackoverflow.com/a/57370526 --> <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous"> <link rel="stylesheet" href="/_includes/md.css"> <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js" integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script> --> <script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script> <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> <script> MathJax = { tex: { tags: 'ams' } }; $(document).ready(function(){ key = 'href'; $('[href^="https://uni-freiburg.cloud.panopto.eu"]').replaceWith(function() { return '<div class="video-container43"><iframe src='+$(this).attr(key)+' frameborder="0" allowfullscreen></iframe></div>'; }); $('[href^="https://www.youtube.com"]').replaceWith(function() { return '<div class="video-container169"><iframe src='+$(this).attr(key)+' frameborder="0" allowfullscreen></iframe></div>'; }); }); </script> <style type="text/css"> .video-container169 { position: relative; padding-bottom: 56.25%; /* 16:9 */ height: 0; } .video-container169 iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; } .video-container43 { position: relative; padding-bottom: 75%; /* 4:3; */ height: 0; } .video-container43 iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; } </style> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="">Lecture</a></li> <li class="breadcrumb-nav-list-item"><span>Chapter 02</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <hr /> <h2 class="chapterHead"> <a href="#x1-10002" class="anchor-heading" aria-labelledby="x1-10002"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span class="titlemark">Chapter 2</span><br /> <a id="x1-10002"></a>Molecular dynamics </h2> <div id="shaded*-1" class="framedenv"><!-- l. 3 --> <p class="noindent"><span class="underline"><span class="cmbx-12">Context:</span></span> Molecular <span class="cmti-12">dynamics</span> follows the motion of individual atoms through a solution of Newton’s equations of motion. We need integration algorithms to be able to solve this set of coupled differential equations on a computer.</p> </div> <h3 class="sectionHead"> <a href="#x1-20002.1" class="anchor-heading" aria-labelledby="x1-20002.1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span class="titlemark">2.1</span> <a id="x1-20002.1"></a>Equations of motion </h3> <!-- l. 11 --> <p class="noindent"><a href="https://uni-freiburg.cloud.panopto.eu/Panopto/Pages/Embed.aspx?id=d3188a05-4143-4602-b6c2-ad15014fe21d" class="url"><span class="cmtt-12">https://uni-freiburg.cloud.panopto.eu/Panopto/Pages/Embed.aspx?id=d3188a05-4143-4602-b6c2-ad15014fe21d</span></a></p> <!-- l. 13 --> <p class="noindent"></p> <h4 class="subsectionHead"> <a href="#x1-30002.1.1" class="anchor-heading" aria-labelledby="x1-30002.1.1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span class="titlemark">2.1.1</span> <a id="x1-30002.1.1"></a>Newton’s equations of motion </h4> <!-- l. 18 --> <p class="noindent">We have now (almost) all the ingredients to carry out a molecular dynamics simulation. From our or potential energy expression \(E_{\text{pot}}(\{\vec{r}_i\})\) discussed in the previous chapter, we obtain the force \begin{equation} \vec{f}_i = \partial E_{\text{pot}}/\partial \vec{r}_i \end{equation} on each of the \(N\) atoms. Once we know the forces, we can obtain the accelerations \(\vec{a}_i\) through Newton’s third law, \begin{equation} \vec{f}_i = m_i \vec{a}_i. \end{equation} We are therefore assuming that atom \(i\) can be described as a point of mass \(m_i\)! The mass can be obtained from the periodic table of elements. Note that the mass listed in the periodic table is usually the average over all isotopes weighted by their occurrence on earth, and this mass is used for most practical purposes. For some application, in particular to understand the different behavior of Hydrogen and Deuterium, it can be necessary to actually model the individual isotopes by using their respective mass.</p> <!-- l. 28 --> <p class="indent">We further have \(\vec{a}_i = \dot{\vec{v}}_i\), where \(\vec{v}_i\) is the velocity of atom \(i\), and \(\vec{v}_i = \dot{\vec{r}}_i\). The dot superscript indicates derivative with respect to time. The set of linear differential equations to solve is therefore \begin{equation} \dot{v}_i(t) = \vec{f}_i(t)/m_i\{\text{ and} }\ \dot{\vec{r}}_i(t) = \vec{v}_i(t) \label{eq:Newton} \end{equation} with the initial (boundary) conditions \(\vec{r}_i(0) = \vec{r}_0\) and \(\vec{v}_i(0) = \vec{v}_0\). Note that the boundary condition is an integral part of the differential Eq. \eqref{eq:Newton}. The state of the system is therefore fully and uniquely determined by the positions \(\vec{r}_i\) and the velocities \(\vec{v}_i\) of all atoms. This set of positions \(\vec{r}_i\) and momenta \(\vec{p}_i = \vec{v}_i/m_i\) defines a point in <span class="cmti-12">phase-space</span> \(\vec{\Gamma } = \{ \vec{r}_i, \vec{p}_i\}\). The evolution of position and velocities given by Eq. \eqref{eq:Newton} can therefore be thought of as a single point moving in the \(6N\) dimensional phase-space. The concept of a phase-space will become important in the next chapter when we talk about statistical mechanics.</p> <div id="shaded*-1" class="framedenv"><!-- l. 35 --> <p class="noindent"><span class="underline"><span class="cmbx-12">Code example:</span></span> For a molecular dynamics code, it is useful to have a data structure that represents the state of the simulation and stores at least positions and velocities. This data structure could also store element names (or atomic numbers), masses and forces. An example that uses <a href="https://eigen.tuxfamily.org/">Eigen</a> arrays as the basic array container is shown below.</p> <!-- l. 37 --> <div id="listing-1" class="lstlisting"><span class="label"><a id="x1-3001r1"></a><span class="cmr-6">1</span></span><span class="cmtt-10">using Positions_t = Eigen::Array3Xd; </span><br /> <span class="label"><a id="x1-3002r2"></a><span class="cmr-6">2</span></span><span class="cmtt-10">using Velocities_t = Eigen::Array3Xd; </span><br /> <span class="label"><a id="x1-3003r3"></a><span class="cmr-6">3</span></span><span class="cmtt-10">using Forces_t = Eigen::Array3Xd; </span><br /> <span class="label"><a id="x1-3004r4"></a><span class="cmr-6">4</span></span><span class="cmtt-10"> </span><br /> <span class="label"><a id="x1-3005r5"></a><span class="cmr-6">5</span></span><span class="cmtt-10">class Atoms { </span><br /> <span class="label"><a id="x1-3006r6"></a><span class="cmr-6">6</span></span><span class="cmtt-10">public: </span><br /> <span class="label"><a id="x1-3007r7"></a><span class="cmr-6">7</span></span><span class="cmtt-10">    Positions_t positions; </span><br /> <span class="label"><a id="x1-3008r8"></a><span class="cmr-6">8</span></span><span class="cmtt-10">    Velocities_t velocities; </span><br /> <span class="label"><a id="x1-3009r9"></a><span class="cmr-6">9</span></span><span class="cmtt-10">    Forces_t forces; </span><br /> <span class="label"><a id="x1-3010r10"></a><span class="cmr-6">10</span></span><span class="cmtt-10"> </span><br /> <span class="label"><a id="x1-3011r11"></a><span class="cmr-6">11</span></span><span class="cmtt-10">    Atoms(Positions_t &amp;p) : </span><br /> <span class="label"><a id="x1-3012r12"></a><span class="cmr-6">12</span></span><span class="cmtt-10">            positions{p}, velocities{3, p.cols()}, forces{3, p.cols()} { </span><br /> <span class="label"><a id="x1-3013r13"></a><span class="cmr-6">13</span></span><span class="cmtt-10">        velocities.setZero(); </span><br /> <span class="label"><a id="x1-3014r14"></a><span class="cmr-6">14</span></span><span class="cmtt-10">        forces.setZero(); </span><br /> <span class="label"><a id="x1-3015r15"></a><span class="cmr-6">15</span></span><span class="cmtt-10">    } </span><br /> <span class="label"><a id="x1-3016r16"></a><span class="cmr-6">16</span></span><span class="cmtt-10"> </span><br /> <span class="label"><a id="x1-3017r17"></a><span class="cmr-6">17</span></span><span class="cmtt-10">    size_t nb_atoms() const { </span><br /> <span class="label"><a id="x1-3018r18"></a><span class="cmr-6">18</span></span><span class="cmtt-10">        return positions.cols(); </span><br /> <span class="label"><a id="x1-3019r19"></a><span class="cmr-6">19</span></span><span class="cmtt-10">    } </span><br /> <span class="label"><a id="x1-3020r20"></a><span class="cmr-6">20</span></span><span class="cmtt-10">};</span></div> <!-- l. 59 --> <p class="indent">As a general rule, the data structure should be designed in a way that data that is processed consecutively is also stored in memory in a continuous manner. This ensures <a href="https://en.wikipedia.org/wiki/Cache_coherence">cache coherenece</a>. For example, we could be tempted to create a class <span class="obeylines-h"><span class="verb"><span class="cmtt-12">Atom</span></span></span> that contains the positions, velocities, etc. of a single atom and than use an array (e.g. <span class="obeylines-h"><span class="verb"><span class="cmtt-12">std::vector&lt;Atom&gt; atoms</span></span></span>) of that class as the basic data structure. However, positions are then no longer consecutive in memory. A function (e.g. computing forces) does not need the velocities would still load them into the cache, as the <a href="https://en.wikipedia.org/wiki/CPU_cache">cache line size</a> for all modern CPUs is \(64\) bytes. For high-performance numerical code, it is therefore <span class="cmti-12">always</span> preferable to use structures of arrays rather than arrays of structure.</p> </div> <!-- l. 62 --> <p class="noindent"></p> <h4 class="subsectionHead"> <a href="#x1-40002.1.2" class="anchor-heading" aria-labelledby="x1-40002.1.2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span class="titlemark">2.1.2</span> <a id="x1-40002.1.2"></a>Kinetic energy and energy conservation </h4> <!-- l. 64 --> <p class="noindent">In addition to the potential energy \(E_{\text{pot}}(\{ \vec{r}_i\})\), the dynamical state of a system is characterized by its kinetic energy, \begin{equation} E_{\text{kin}}(\{ \vec{p}_i\}) = \sum _i \frac{1}{2} \frac{p_i^2}{m_i}. \end{equation}</p> <div id="shaded*-1" class="framedenv"><!-- l. 69 --> <p class="noindent"><span class="underline"><span class="cmbx-12">Note:</span></span> The <span class="cmti-12">temperature</span> is simply a measure of the kinetic energy of the system, \(\frac{3}{2} N k_B T = E_{\text{kin}}\) where \(N\) is the number of atoms. In other words, \(E_{\text{kin}}\) measures the variance of the velocity distribution, which is Gaussian. We will learn more about this when discussing the basics of statistical mechanics.</p> </div> <!-- l. 73 --> <p class="indent">The total energy \begin{equation} H(\{ \vec{r}_i\},\{ \vec{p}_i\}) = E_{\text{kin}}(\{ \vec{p}_i\}) + E_{\text{pot}}(\{ \vec{r}_i\}) \label{eq:hamil} \end{equation} is a conserved quantity during the motion of the atoms. This can be seen by showing that the derivative of the total energy with respect to time vanishes, \begin{equation} \dot{H} = \dot{E}_{\text{kin}} + \dot{E}_{\text{pot}} = \sum _i \frac{\vec{p}_i \dot{\vec{p}}_i}{m_i} + \sum _i \frac{\partial E_{\text{pot}}}{\partial \vec{r}_i} \dot{\vec{r_i}} = \sum _i \vec{v}_i \vec{f}_i - \sum _i \vec{v}_i \vec{f}_i = 0. \end{equation} \(H\) is also called the <span class="cmti-12">Hamiltonian</span> of the system.</p> <div id="shaded*-1" class="framedenv"><!-- l. 85 --> <p class="noindent"><span class="underline"><span class="cmbx-12">Note:</span></span> Measuring the total energy (or any other conserved quantity!) and checking whether it is constant in a molecular dynamics simulation is a way of testing if the time step \(\Delta t\) used in the numerical integration is small enough. We will discuss numerical integration in detail below.</p> </div> <!-- l. 89 --> <p class="indent">A generalization of Newton’s equations of motion are <span class="cmti-12">Hamilton’s equations of</span> <span class="cmti-12">motion</span>, \begin{align} \dot{\vec{r}}_i &amp;= \frac{\partial H}{\partial \vec{p}_i} \\ \dot{\vec{p}}_i &amp;= -\frac{\partial H}{\partial \vec{r}_i}, \end{align}</p> <!-- l. 94 --> <p class="indent">and it is straightforward to show that these equations reduce to Newton’s equations of motions for the Hamiltonian given by Eq. \eqref{eq:hamil}. Hamilton’s equation of motion remain valid when positions \(\vec{r}_i\) and momenta \(\vec{p}_i\) are replaced by generalized coordinates that consider constraints, such as for example the angle of a (rigid) pendulum. These equations will become important when we discuss statistical mechanics and temperature control in molecular dynamics simulations using <span class="cmti-12">thermostats</span>, where a generalized degree of freedom is the internal state of the heat bath that controls the temperature. A full derivation of Hamilton’s equations of motion is given in Chap. <span class="cmbx-12">??</span>.</p> <!-- l. 96 --> <p class="noindent"></p> <h3 class="sectionHead"> <a href="#x1-50002.2" class="anchor-heading" aria-labelledby="x1-50002.2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span class="titlemark">2.2</span> <a id="x1-50002.2"></a>Integration algorithms </h3> <!-- l. 99 --> <p class="noindent"><a href="https://uni-freiburg.cloud.panopto.eu/Panopto/Pages/Embed.aspx?id=50b66784-6560-4aea-8654-ad16004e1442" class="url"><span class="cmtt-12">https://uni-freiburg.cloud.panopto.eu/Panopto/Pages/Embed.aspx?id=50b66784-6560-4aea-8654-ad16004e1442</span></a></p> <!-- l. 101 --> <p class="indent">The main ingredient in any molecular dynamics simulation, regardless of the underlying model, is the numerical solution of Eqs. \eqref{eq:Newton}. A plethora of algorithms have been developed over the years, but for most practical purposes the Velocity-Verlet algorithm is used nowadays. For instructive purposes we will start out with a simple integration method, the Euler integration, before discussing Velocity-Verlet.</p> <!-- l. 103 --> <p class="noindent"></p> <h4 class="subsectionHead"> <a href="#x1-60002.2.1" class="anchor-heading" aria-labelledby="x1-60002.2.1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span class="titlemark">2.2.1</span> <a id="x1-60002.2.1"></a>Euler integration </h4> <!-- l. 104 --> <p class="noindent">In order to follow the trajectories of all atoms we need to integrate the above differential equation. On a computer, a continuous differential equation needs to be replaced by a discrete equation. Equations \eqref{eq:Newton} are continuous in time and hence need to be discretized. (Note that our system is already discrete spatially since we are dealing with mass points, but each of these points corresponds to a physical object so this is not the result of a discretization procedure.) The simplest integration is the Euler algorithm in which forces and velocities are assumed to be constant over time intervals \(\Delta t\).</p> <!-- l. 107 --> <p class="indent">To see this, we write the above differential equation as \begin{equation} d \vec{v}_i = \frac{\vec{f}_i(t)}{m_i}\{\text{ and} }\ d\vec{r}_i(t) = \vec{v}_i(t)\,dt \end{equation} i.e., we move the differential \(d t\) of \(\dot{\vec{v}}_i = d\vec{v}/d t\) to the right hand side of the equation. We can now straightforwardly integrate the equation from time \(t\) to time \(t + \Delta t\) while assuming that \(\vec{f}_i\) and \(\vec{v}_i\) remain constant. This yields \begin{align} \vec{v}_i(t+\Delta t) - \vec{v}_i(t) &amp;= \frac{\vec{f}_i(t)}{m_i} \Delta t \label{eq:eulerexplicita} \\ \vec{r}_i(t+\Delta t) - \vec{r}_i(t) &amp;= \vec{v}_i(t) \Delta t \label{eq:eulerexplicitb} \end{align}</p> <!-- l. 116 --> <p class="indent">which is obviously only a good approximation for small \(\Delta t\)! This algorithm is called Euler integration.</p> <!-- l. 118 --> <p class="indent">Same equation can be derived by Taylor-expanding \(\vec{r}_i(t+\Delta t)\) up to first order in \(\Delta t\). The algorithm is hence \(O(\Delta t^2)\). The Euler algorithm is not reversible, i.e. starting from time \(t+\Delta t\) and integrating backwards one ends up with a different result at time \(t\). Applying the Euler algorithm with timestep \(-\Delta t\) gives \begin{align} \vec{v}_i(t) - \vec{v}_i(t+\Delta t) &amp;= -\frac{\vec{f}_i(t+\Delta t)}{m_i} \Delta t \\ \vec{r}_i(t) - \vec{r}_i(t+\Delta t) &amp;= -\vec{v}_i(t+\Delta t) \Delta t \end{align}</p> <!-- l. 126 --> <p class="indent">These equations cannot be re-arranged to give Eqs. \eqref{eq:eulerexplicita} and \eqref{eq:eulerexplicitb}. Euler integration is generally not a good algorithm and requires very small time steps.</p> <!-- l. 131 --> <p class="noindent"></p> <h4 class="subsectionHead"> <a href="#x1-70002.2.2" class="anchor-heading" aria-labelledby="x1-70002.2.2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span class="titlemark">2.2.2</span> <a id="x1-70002.2.2"></a>Leap-frog integration </h4> <!-- l. 132 --> <p class="noindent">Leap-frog stores position at times \(t_i\) and velocities at times \(t_i+\Delta t/2\) and can be derived from a argument similar to the one given above. Specifically, we combine the results of a Taylor expansion \(\pm \Delta t/2\), yielding \begin{align} \vec{v}_i(t+\Delta t/2) - \vec{v}_i(t-\Delta t/2) &amp;= \frac{\vec{f}_i(t)}{m_i} \Delta t \label{eq:leapfrog1} \\ \vec{r}_i(t+\Delta t) - \vec{r}_i(t) &amp;= \vec{v}_i(t+\Delta t/2) \Delta t. \end{align}</p> <!-- l. 139 --> <p class="indent">Note that Eq. \eqref{eq:leapfrog1} is similar to Eq. \eqref{eq:eulerexplicita}, except the force is evaluated at the mid-point. The resulting algorithm is reversible. Applying the Leap-frog algorithm with timestep \(-\Delta t\) gives \begin{align} \vec{v}_i(t-\Delta t/2) - \vec{v}_i(t+\Delta t/2) &amp;= -\frac{\vec{f}_i(t)}{m_i} \Delta t \\ \vec{r}_i(t) - \vec{r}_i(t+\Delta t) &amp;= -\vec{v}_i(t+\Delta t/2) \Delta t \end{align}</p> <!-- l. 145 --> <p class="indent">Bring the terms on the left hand side to the right and vice-versa, and you arrive at the original equations for forward integration. Leap-frog is therefore <span class="cmti-12">reversible</span>.</p> <!-- l. 147 --> <p class="noindent"></p> <h4 class="subsectionHead"> <a href="#x1-80002.2.3" class="anchor-heading" aria-labelledby="x1-80002.2.3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span class="titlemark">2.2.3</span> <a id="x1-80002.2.3"></a>Verlet integration </h4> <!-- l. 149 --> <p class="noindent">Let us now Taylor expand \(\vec{r}_i(t\pm \Delta t)\) up to third order in \(\pm \Delta t\), \begin{equation} \label{eq:taylor_tplus} \vec{r}_i(t\pm \Delta t) = \vec{r}_i(t) \pm \vec{v}_i(t) \Delta t + \frac{1}{2m_i} \vec{f}_i(t) \Delta t^2 \pm \frac{1}{6} \dot{\dot{\dot{\vec{r}}}}_i(t) \Delta t^3 + O(\Delta t^4). \end{equation} Note that only the odd exponents see the sign of \(\pm \Delta t\). The sum of this equation for expansion in \(+\Delta t\) and \(-\Delta t\) gives the positions update, \begin{equation} \vec{r}_i(t+\Delta t) + \vec{r}_i(t-\Delta t) = 2\vec{r}_i(t) + \frac{1}{m_i} \vec{f}_i(t) \Delta t^2 + O(\Delta t^4). \label{eq:verlet} \end{equation} Eq. \eqref{eq:verlet} is called the Verlet algorithm. Instead of requiring the positions \(\{ \vec{r}_i(t)\}\) and velocities \(\{ \vec{v}_i(t)\}\) it requires the positions of the current \(\{ \vec{r}_i(t)\}\) and past \(\{ \vec{r}_i(t-\Delta t)\}\) times for the integration.</p> <!-- l. 162 --> <p class="indent">The difference between the expansion for \(+\Delta t\) and \(-\Delta t\) yields the velocities, \begin{equation} \vec{r}_i(t+\Delta t) - \vec{r}_i(t-\Delta t) = 2\vec{v}_i(t) \Delta t + O(\Delta t^3). \end{equation} Note that in order to compute the velocities at time t in the regular Verlet algorithm, we need to know the positions at time \(t + \Delta t\). Verlet and Leap-Frog are identical algorithms, since Leap-Frog stores the velocities at the intermediate time \(t+\Delta t/2\). It is usually useful to be able to know both, positions and velocities, at time \(t\). This problem is solved by the Velocity-Verlet algorithm, described in the following section.</p> <!-- l. 169 --> <p class="noindent"></p> <h4 class="subsectionHead"> <a href="#x1-90002.2.4" class="anchor-heading" aria-labelledby="x1-90002.2.4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span class="titlemark">2.2.4</span> <a id="x1-90002.2.4"></a>Velocity-Verlet integration </h4> <!-- l. 171 --> <p class="noindent">Let us now also Taylor expand \(\vec{r}_i(t)\) up to third order in \(\Delta t\) at \(\vec{r}_i(t+\Delta t)\), i.e. we integrate backwards in time from \(t + \Delta t\) to \(t\). This gives \begin{equation} \vec{r}_i(t) = \vec{r}_i(t+\Delta t) - \vec{v}_i(t+\Delta t) \Delta t + \frac{1}{2m_i} \vec{f}_i(t+\Delta t) \Delta t^2 - \frac{1}{6} \dot{\dot{\dot{\vec{r}}}}_i(t) \Delta t^3 + O(\Delta t^3) \label{eq:taylor_r} \end{equation} Equation \eqref{eq:taylor˙tplus} is the positions update of the Velocity-Verlet algorithm. The sum of Eq. \eqref{eq:taylor˙tplus} and Eq. \eqref{eq:taylor˙r} gives the velocity update in the Velocity-Verlet algorithm: \begin{align} \vec{r}_i(t+\Delta t) &amp;= \vec{r}_i(t) + \vec{v}_i(t)\Delta t + \frac{1}{2m_i} \vec{f}_i(t) \Delta t^2\\ \vec{v}_i(t+\Delta t) &amp;= \vec{v}_i(t) + \frac{1}{2m_i} \left (\vec{f}_i(t) + \vec{f}_i(t+\Delta t) \right ) \Delta t, \end{align}</p> <!-- l. 181 --> <p class="indent">Note that this algorithm is often split in the form of a predictor-corrector scheme since this saves computation time and the necessity to keep past forces around. The predictor step is \begin{align} \vec{v}_i(t+\Delta t/2) &amp;= \vec{v}_i(t) + \frac{1}{2m_i} \vec{f}_i(t) \Delta t \label{eq:vvpred1} \\ \vec{r}_i(t+\Delta t) &amp;= \vec{r}_i(t) + \vec{v}_i(t+\Delta t/2) \Delta t \label{eq:vvpred2} \end{align}</p> <!-- l. 189 --> <p class="indent">where \(\vec{v}_i(t+\Delta t/2)\) is the predicted velocity. After this we compute new forces, \(\vec{f}_i(t+\Delta t)\). We then correct the velocities via \begin{equation} \vec{v}_i(t+\Delta t) = \vec{v}_i(t+\Delta t/2) + \frac{1}{2m_i} \vec{f}_i(t+\Delta t) \Delta t \end{equation} The Velocity-Verlet algorithm is the integration algorithm used in most molecular dynamics codes. It has the additional properties that is it <span class="cmti-12">symplectic</span>, which means it conserves phase-space volume. We will come back to what this mean when talking about statistical mechanics.</p> <div id="shaded*-1" class="framedenv"><!-- l. 196 --> <p class="noindent"><span class="underline"><span class="cmbx-12">Code example:</span></span> We can implement the velocity-verlet algorithm in a few lines of C++ code using vectorized <span class="obeylines-h"><span class="verb"><span class="cmtt-12">Eigen</span></span></span> operations. The prediction step</p> <!-- l. 198 --> <div id="listing-2" class="lstlisting"><span class="label"><a id="x1-9001r1"></a><span class="cmr-6">1</span></span><span class="cmtt-10">void verlet_step1(Atoms &amp;atoms, double timestep, double mass) { </span><br /> <span class="label"><a id="x1-9002r2"></a><span class="cmr-6">2</span></span><span class="cmtt-10">    atoms.velocities += 0.5 * atoms.forces * timestep / mass; </span><br /> <span class="label"><a id="x1-9003r3"></a><span class="cmr-6">3</span></span><span class="cmtt-10">    atoms.positions += atoms.velocities * timestep; </span><br /> <span class="label"><a id="x1-9004r4"></a><span class="cmr-6">4</span></span><span class="cmtt-10">}</span></div> <!-- l. 204 --> <p class="indent">implements Eq. \eqref{eq:vvpred1}. We then compute new forces and correct the velocities via</p> <!-- l. 205 --> <div id="listing-3" class="lstlisting"><span class="label"><a id="x1-9005r1"></a><span class="cmr-6">1</span></span><span class="cmtt-10">void verlet_step2(Atoms &amp;atoms, double timestep, double mass) { </span><br /> <span class="label"><a id="x1-9006r2"></a><span class="cmr-6">2</span></span><span class="cmtt-10">    atoms.velocities += 0.5 * atoms.forces * timestep / mass; </span><br /> <span class="label"><a id="x1-9007r3"></a><span class="cmr-6">3</span></span><span class="cmtt-10">}</span></div> </div> <div id="shaded*-1" class="framedenv"><!-- l. 215 --> <p class="noindent"><span class="underline"><span class="cmbx-12">Note:</span></span> The timestep in MD simulations has to be on the order of femtoseconds, in order to resolve the fastest atomic vibrations. For example, in simulations with metals and Embedded Atom Method (EAM) potentials, \(\Delta t=1\) fs is typically a safe choice. How can we check that the timestep is sensible? One possibility is to simply propage a configuration in time using the Velocity-Verlet algorithm. This is sometimes called the micro-canonical or NVE ensemble. (NVE because number of atoms, volume and energy is constant.) We then record the evolution of the total (kinetic plus potential) energy, which should be constant. The discrete time integration scheme will introduce numerical errors. If \(\Delta t\) is too large, there will be noticeable drift of the total energy. The figures below show the results of such a simulation. A system of \(108000\) Au atoms was simulated for \(100\) ps with various values of \(\Delta t\). The \(y\)-axis shows the difference between the current and initial values of the total energy. The data was smoothened to suppress high-frequency fluctuations in the figure. For this system, even \(5\) fs would still be an acceptable time step.</p> <div class="center"><!-- l. 226 --> <p class="noindent"></p> <!-- l. 227 --> <p class="noindent"><img width="390" height="390" src="figures/etot_vs_time_as_function_of_timestep_Grochola_Au_NVE_ensemble_01.png" alt="PIC" /> <img width="390" height="390" src="figures/etot_vs_time_as_function_of_timestep_Grochola_Au_NVE_ensemble_02.png" alt="PIC" /></p> </div> </div> <h2 class="likechapterHead"> <a href="#x1-100002.2.4" class="anchor-heading" aria-labelledby="x1-100002.2.4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a id="x1-100002.2.4"></a>Bibliography </h2> <hr> <footer> <p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2017-2020 Andreas Greiner, 2020-2021 Lars Pastewka.</a></p> <div class="d-flex mt-2"> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
